(window.webpackJsonp=window.webpackJsonp||[]).push([[197],{867:function(s,t,a){"use strict";a.r(t);var n=a(17),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"模块机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块机制"}},[s._v("#")]),s._v(" 模块机制")]),s._v(" "),a("p",[s._v("[TOC]")]),s._v(" "),a("h2",{attrs:{id:"一、commonjs规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、commonjs规范"}},[s._v("#")]),s._v(" 一、CommonJS规范")]),s._v(" "),a("ul",[a("li",[s._v("目标：为了构建JavaScript在包括Web服务器，桌面，命令行工具，及浏览器方面的生态系统。")])]),s._v(" "),a("h3",{attrs:{id:"_1-1-简单模块定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-简单模块定义"}},[s._v("#")]),s._v(" 1.1 简单模块定义")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// circle.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PI")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PI")]),s._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("area")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("r")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PI")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" r "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" r\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("circumference")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("r")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PI")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" r\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// app.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" circle "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./circle.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'The area of a circle of radius 4 is'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" circle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("area")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_1-2-模块载入策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-模块载入策略"}},[s._v("#")]),s._v(" 1.2 模块载入策略")]),s._v(" "),a("ul",[a("li",[s._v("Node.js的模块分为两类，一类为原生模块（核心），一类为文件模块。")]),s._v(" "),a("li",[s._v("Node.js对原生模块和文件模块都进行了缓存，于是在第二次require时，是不会有重复开销的。")])]),s._v(" "),a("h4",{attrs:{id:"_1-2-1-原生模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-原生模块"}},[s._v("#")]),s._v(" 1.2.1 原生模块")]),s._v(" "),a("ul",[a("li",[s._v("原生模块在Node.js源代码编译的时候编译进了二进制执行文件，加载的速度最快。")])]),s._v(" "),a("h4",{attrs:{id:"_1-2-2-文件模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-文件模块"}},[s._v("#")]),s._v(" 1.2.2 文件模块")]),s._v(" "),a("ul",[a("li",[s._v("以后缀不同分成三类模块\n"),a("ul",[a("li",[s._v(".js：通过fs模块同步读取js文件并编译执行。")]),s._v(" "),a("li",[s._v(".node：通过C/C++进行编写的Addon，通过dlopen方法进行加载。")]),s._v(" "),a("li",[s._v(".json：读取文件，调用JSON.parse解析加载。")])])])]),s._v(" "),a("h4",{attrs:{id:"_1-2-3-require方法中的文件查找策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-require方法中的文件查找策略"}},[s._v("#")]),s._v(" 1.2.3 require方法中的文件查找策略")]),s._v(" "),a("ul",[a("li",[s._v("优先级\n"),a("ol",[a("li",[s._v("从文件模块缓存中加载")]),s._v(" "),a("li",[s._v("从原生模块加载")]),s._v(" "),a("li",[s._v("从文件加载")])])])]),s._v(" "),a("h2",{attrs:{id:"二、包结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、包结构"}},[s._v("#")]),s._v(" 二、包结构")]),s._v(" "),a("blockquote",[a("p",[s._v("JavaScript缺少包结构，CommonJS致力于改变这种现状，于是定义了包的结构规范。")]),s._v(" "),a("p",[s._v("而NPM(包管理器)的出现则是为了在CommonJS规范的基础上，实现解决包的安装卸载，依赖管理，版本管理等问题。")])]),s._v(" "),a("ul",[a("li",[s._v("一个符合CommonJS规范的包应该是如下这种结构\n"),a("ul",[a("li",[s._v("package.json：包描述文件。")]),s._v(" "),a("li",[s._v("bin：用于存放可执行二进制文件的目录。")]),s._v(" "),a("li",[s._v("lib：用于存放JavaScript代码的目录。")]),s._v(" "),a("li",[s._v("doc：用于存放文档的目录。")]),s._v(" "),a("li",[s._v("test：用于存档单元测试用例的代码。")])])])])])}),[],!1,null,null,null);t.default=r.exports}}]);